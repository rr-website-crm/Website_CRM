<!-- process/templates/process/process_dashboard.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Process Dashboard - CRM Portal{% endblock %}

{% block content %}
{% now "l, F d, Y" as process_today %}
{% with welcome_name=process_member_name|default:request.user.get_full_name|default:request.user.email %}
<div class="dashboard-header">
    <div>
        <h1 class="dashboard-title">Process Dashboard</h1>
        <p class="dashboard-subtitle">
            Welcome back, {{ welcome_name }} | {{ process_today }}
        </p>
    </div>
</div>
{% endwith %}

<!-- Stats Overview -->
<div class="stats-grid">
    <div class="stat-card gradient-primary">
        <div class="stat-value">{{ total_jobs }}</div>
        <div class="stat-label">Total Active Jobs</div>
    </div>
    <div class="stat-card gradient-secondary">
        <div class="stat-value">{{ jobs.paginator.count }}</div>
        <div class="stat-label">Jobs This Page</div>
    </div>
</div>

<!-- Jobs Table -->
<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>Job ID</th>
                <th>Topic</th>
                <th>Word Count</th>
                <th>Deadline</th>
                <th>Referencing</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for job in jobs %}
            <tr>
                <td>
                    <span style="font-family: monospace; font-weight: 600; color: var(--primary);">
                        {{ job.get_masked_job_id }}
                    </span>
                </td>
                <td>
                    <span style="filter: blur(3px); user-select: none;">
                        {{ job.topic|truncatewords:5 }}
                    </span>
                </td>
                <td>
                    <span style="filter: blur(3px); user-select: none;">
                        {{ job.word_count }}
                    </span>
                </td>
                <td>
                    <span style="filter: blur(3px); user-select: none;">
                        {{ job.deadline|date:"d/m/Y H:i" }}
                    </span>
                </td>
                <td>
                    <span style="filter: blur(3px); user-select: none;">
                        {{ job.referencing }}
                    </span>
                </td>
                <td>
                    <span style="filter: blur(3px); user-select: none;">
                        {% if job.status == 'allocated' %}
                        <span class="status-tag status-allocated">Allocated</span>
                        {% elif job.status == 'in_progress' %}
                        <span class="status-tag status-in-progress">In Progress</span>
                        {% elif job.status == 'submitted' %}
                        <span class="status-tag status-completed">Submitted</span>
                        {% else %}
                        <span class="status-tag">{{ job.get_status_display }}</span>
                        {% endif %}
                    </span>
                </td>
                <td>
                    {% if job.writer_final_file %}
                    <a href="{% url 'view_job' job.job_id %}" class="btn btn-primary" style="padding: 8px 16px; font-size: 13px;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 4px;">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        View
                    </a>
                    {% else %}
                    <button class="btn btn-outline" disabled style="padding: 8px 16px; font-size: 13px; opacity: 0.5; cursor: not-allowed;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 4px;">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h2v-2h-2v2zm0-4h2V7h-2v6z" fill="currentColor"/>
                        </svg>
                        Locked
                    </button>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center" style="padding: 2rem;">
                    <p style="font-size: 1.1rem; opacity: 0.7;">No jobs assigned yet.</p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if jobs.has_other_pages %}
<div style="display: flex; justify-content: center; align-items: center; gap: 1rem; margin-top: 2rem;">
    {% if jobs.has_previous %}
    <a href="?page=1" class="btn btn-outline" style="padding: 8px 16px;">First</a>
    <a href="?page={{ jobs.previous_page_number }}" class="btn btn-outline" style="padding: 8px 16px;">Previous</a>
    {% endif %}
    
    <span style="color: var(--text-color); font-weight: 500;">
        Page {{ jobs.number }} of {{ jobs.paginator.num_pages }}
    </span>
    
    {% if jobs.has_next %}
    <a href="?page={{ jobs.next_page_number }}" class="btn btn-outline" style="padding: 8px 16px;">Next</a>
    <a href="?page={{ jobs.paginator.num_pages }}" class="btn btn-outline" style="padding: 8px 16px;">Last</a>
    {% endif %}
</div>
{% endif %}

<style>
.stat-card {
    animation: fadeInUp 0.5s ease-out;
}

.stat-card:nth-child(2) {
    animation-delay: 0.1s;
}

.data-table tbody tr {
    animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
</style>
{% endblock %}
