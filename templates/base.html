<!-- base.html -->
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{% block title %}CRM Portal{% endblock %}</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <!-- <link rel="preconnect" href="https://fonts.googleapis.com"> -->
    <!-- <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> -->
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet"> -->
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="icon" type="image/jpeg" href="{{ MEDIA_URL }}logo.png">
    <link rel="shortcut icon" href="{{ MEDIA_URL }}logo.png">
    <link rel="apple-touch-icon" href="{{ MEDIA_URL }}logo.png">

    {% block extra_css %}{% endblock %}
</head>
<body class="{% block body_class %}{% if user.is_authenticated %}{% if user.role == 'writer' %}theme-writer-2{% elif user.role == 'process' %}theme-process-2{% else %}theme-{{ user.role|default:'user'|lower }}-3{% endif %}{% else %}theme-user-3{% endif %}{% endblock %}">
    <div class="app-wrapper {% if sidebar_open %}sidebar-open{% endif %}">
        
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <button class="hamburger-btn" id="hamburgerBtn" aria-label="Toggle Menu">
                    <div class="hamburger-icon">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </button>
                <h1 class="logo" style="font-size: 20px; font-weight: 700; margin: 0; display: inline-flex; align-items: center; gap: 0.5rem;">
                    <img src="{{ MEDIA_URL }}logo.png" alt="CRM Portal logo" style="height: 32px; width: 32px; object-fit: cover; border-radius: 6px;">
                    CRM Portal
                </h1>
            </div>
            
            <div class="header-right">
                <div class="user-profile">
                    {% if user.is_authenticated %}
                        <img src="{% if user.profile_image %}{{ user.profile_image.url }}{% else %}{% static 'img/default-avatar.png' %}{% endif %}" 
                             alt="Profile" 
                             class="profile-image"
                             onerror="this.src='https://ui-avatars.com/api/?name={{ user.get_full_name|urlencode }}&background=random&color=fff'">
                        <div class="profile-info">
                            <span class="user-name">{{ user.get_full_name|default:user.email }}</span>
                            <span class="user-role">{{ user.role|default:"User" }}</span>
                        </div>
                    {% endif %}
                </div>
                
                {% if user.is_authenticated %}
                <a href="{% url 'logout' %}" class="logout-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V3.33333C2 2.97971 2.14048 2.64057 2.39052 2.39052C2.64057 2.14048 2.97971 2 3.33333 2H6M10.6667 11.3333L14 8M14 8L10.6667 4.66667M14 8H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Logout</span>
                </a>
                {% endif %}
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="app-sidebar" id="sidebar">
            <nav class="sidebar-menu">
                <!-- Common Menu -->
                <div class="menu-section">
                    <div class="menu-section-title">Common</div>
                    <a href="{% url 'home_dashboard' %}" class="menu-item {% if request.resolver_match.url_name == 'home_dashboard' %}active{% endif %}">
                        <span class="menu-item-icon">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </span>
                        <span class="menu-item-text">Home</span>
                    </a>
                    
                    <a href="{% url 'profile' %}" class="menu-item {% if request.resolver_match.url_name == 'profile' %}active{% endif %}">
                        <span class="menu-item-icon">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </span>
                        <span class="menu-item-text">Profile</span>
                    </a>
                </div>

                <!-- Role-Specific Menu -->
                {% if user.is_authenticated %}
                    
                    <!-- SuperAdmin Menu -->
                    {% if user.role == 'superadmin' %}
                    <div class="menu-section">
                        <div class="menu-section-title">Super Admin</div>
                        <a href="{% url 'superadmin_dashboard' %}" class="menu-item {% if 'superadmin_dashboard' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="3" y="3" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="14" y="3" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="14" y="14" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="3" y="14" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Dashboard</span>
                        </a>
                        
                        <a href="{% url 'manage_users' %}" class="menu-item {% if 'manage_users' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M23 21V19C22.9993 18.1137 22.7044 17.2528 22.1614 16.5523C21.6184 15.8519 20.8581 15.3516 20 15.13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M16 3.13C16.8604 3.35031 17.623 3.85071 18.1676 4.55232C18.7122 5.25392 19.0078 6.11683 19.0078 7.005C19.0078 7.89318 18.7122 8.75608 18.1676 9.45769C17.623 10.1593 16.8604 10.6597 16 10.88" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Manage Users</span>
                        </a>
                        
                        <a href="{% url 'pending_items' %}" class="menu-item {% if 'pending' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <polyline points="12 6 12 12 16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Pending</span>
                        </a>

                        <a href="{% url 'master_input' %}" class="menu-item {% if 'master-input' in request.path or 'holiday-master' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M19 11H5M19 11C20.1046 11 21 11.8954 21 13V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V13C3 11.8954 3.89543 11 5 11M19 11V9C19 7.89543 18.1046 7 17 7M5 11V9C5 7.89543 5.89543 7 7 7M7 7V5C7 3.89543 7.89543 3 9 3H15C16.1046 3 17 3.89543 17 5V7M7 7H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Master Input</span>
                        </a>
                    </div>
                    {% endif %}

                    <!-- Admin Menu -->
                    {% if user.role == 'admin' %}
                    <div class="menu-section">
                        <div class="menu-section-title">Admin</div>
                        <a href="{% url 'adminpanel:dashboard' %}" class="menu-item {% if 'adminpanel/dashboard' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="3" y="3" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="14" y="3" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="14" y="14" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="3" y="14" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Dashboard</span>
                        </a>
                        
                        <a href="{% url 'adminpanel:manage_users' %}" class="menu-item {% if 'adminpanel/manage-users' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M23 21V19C22.9993 18.1137 22.7044 17.2528 22.1614 16.5523C21.6184 15.8519 20.8581 15.3516 20 15.13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Manage Users</span>
                        </a>

                        <a href="{% url 'adminpanel:pending_items' %}" class="menu-item {% if 'adminpanel/pending' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <polyline points="12 6 12 12 16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Pending Items</span>
                        </a>
                    </div>
                    {% endif %}

                    <!-- Marketing Menu -->
                    {% if user.role == 'marketing' %}
                    <div class="menu-section">
                        <div class="menu-section-title">Marketing</div>
                        <a href="{% url 'marketing_dashboard' %}" class="menu-item {% if 'marketing_dashboard' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="3" y="3" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="14" y="3" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="14" y="14" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="3" y="14" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Dashboard</span>
                        </a>

                        <a href="{% url 'customer_management' %}" class="menu-item {% if 'customers' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M23 21V19C22.9993 18.1137 22.7044 17.2528 22.1614 16.5523C21.6184 15.8519 20.8581 15.3516 20 15.13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M16 3.13C16.8604 3.35031 17.623 3.85071 18.1676 4.55232C18.7122 5.25392 19.0078 6.11683 19.0078 7.005C19.0078 7.89318 18.7122 8.75608 18.1676 9.45769C17.623 10.1593 16.8604 10.6597 16 10.88" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Customer</span>
                        </a>
                        
                        <!-- <a href="{% url 'create_job' %}" class="menu-item {% if 'create_job' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Create Job</span>
                        </a> -->
                        <!-- CREATE JOB WITH COLLAPSIBLE SUBMENU -->
<!-- CREATE JOB WITH COLLAPSIBLE SUBMENU -->
<div class="menu-item menu-dropdown" onclick="toggleSubmenu('job-submenu', this)">
    <span class="menu-item-icon">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2"
                  stroke-linecap="round" stroke-linejoin="round"></line>
            <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2"
                  stroke-linecap="round" stroke-linejoin="round"></line>
        </svg>
    </span>
    <span class="menu-item-text">Create Job</span>

    <!-- + / - ICON -->
    <span class="dropdown-toggle-symbol">+</span>
</div>

<!-- SUBMENU -->
<div id="job-submenu" class="submenu">
    <a href="{% url 'create_job' %}"
       class="submenu-item {% if 'create_job' in request.path %}active{% endif %}">
        With AI Summary
    </a>

    <a href="{% url 'create_manual_job' %}"
       class="submenu-item {% if 'create_job' in request.path and 'ai' not in request.path %}active{% endif %}">
        Create Job (Manual Entry)
    </a>
</div>


                        <a href="{% url 'my_jobs' %}" class="menu-item {% if 'my_jobs' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 7H4C2.89543 7 2 7.89543 2 9V19C2 20.1046 2.89543 21 4 21H20C21.1046 21 22 20.1046 22 19V9C22 7.89543 21.1046 7 20 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M16 21V5C16 4.46957 15.7893 3.96086 15.4142 3.58579C15.0391 3.21071 14.5304 3 14 3H10C9.46957 3 8.96086 3.21071 8.58579 3.58579C8.21071 3.96086 8 4.46957 8 5V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">My Jobs</span>
                        </a>
                        
                        <a href="{% url 'hold_jobs' %}" class="menu-item {% if 'hold_jobs' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="9" y="9" width="6" height="6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Hold Jobs</span>
                        </a>
                        
                        <a href="{% url 'query_jobs' %}" class="menu-item {% if 'query_jobs' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Query Jobs</span>
                        </a>
                        
                        <a href="{% url 'unallocated_jobs' %}" class="menu-item {% if 'unallocated_jobs' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M9 11L12 14L22 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M21 12V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Unallocated Jobs</span>
                        </a>
                        
                        <a href="{% url 'completed_jobs' %}" class="menu-item {% if 'completed_jobs' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <polyline points="20 6 9 17 4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Completed Jobs</span>
                        </a>
                        
                        <a href="{% url 'allocated_jobs' %}" class="menu-item {% if 'allocated_jobs' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M16 21V5C16 4.46957 15.7893 3.96086 15.4142 3.58579C15.0391 3.21071 14.5304 3 14 3H10C9.46957 3 8.96086 3.21071 8.58579 3.58579C8.21071 3.96086 8 4.46957 8 5V21M4 7H20M4 11H20M4 15H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Allocated Jobs</span>
                        </a>
                    </div>
                    {% endif %}

                    <!-- Allocator Menu -->
                    {% if user.role == 'allocator' %}
                    <div class="menu-section">
                        <div class="menu-section-title">Allocator</div>
                        <a href="{% url 'allocator_dashboard' %}" class="menu-item {% if 'allocator_dashboard' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="3" y="3" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="14" y="3" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="14" y="14" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="3" y="14" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Dashboard</span>
                        </a>
                        
                        <a href="{% url 'pending_allocation' %}" class="menu-item {% if 'pending_allocation' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <polyline points="12 6 12 12 16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Pending Allocation</span>
                        </a>

                        <a href="{% url 'allocator_all_projects' %}" class="menu-item {% if 'all-projects' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="3" y="4" width="18" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
                                    <path d="M3 9H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <circle cx="8" cy="6.5" r="0.8" fill="currentColor"/>
                                    <circle cx="12" cy="6.5" r="0.8" fill="currentColor"/>
                                    <circle cx="16" cy="6.5" r="0.8" fill="currentColor"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">All Projects</span>
                        </a>
                        
                        <a href="{% url 'assigned_jobs' %}" class="menu-item {% if 'assigned_jobs' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.7088 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4881 2.02168 11.3363C2.16356 9.18455 2.99721 7.13631 4.39828 5.49706C5.79935 3.85781 7.69279 2.71537 9.79619 2.24013C11.8996 1.76489 14.1003 1.98232 16.07 2.86" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <polyline points="22 4 12 14.01 9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Assigned Jobs</span>
                        </a>
                        
                        <a href="{% url 'in_progress_jobs' %}" class="menu-item {% if 'in_progress_jobs' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 2V6M12 18V22M4.93 4.93L7.76 7.76M16.24 16.24L19.07 19.07M2 12H6M18 12H22M4.93 19.07L7.76 16.24M16.24 7.76L19.07 4.93" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">In Progress Jobs</span>
                        </a>
                        
                        <a href="{% url 'cancel_jobs' %}" class="menu-item {% if 'cancel_jobs' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Cancel Jobs</span>
                        </a>
                        
                        <a href="{% url 'hold_jobs_allocator' %}" class="menu-item {% if 'hold_jobs_allocator' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="9" y="9" width="6" height="6" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Hold Jobs</span>
                        </a>
                        
                        <a href="{% url 'process_jobs' %}" class="menu-item {% if 'process_jobs' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M14.7 6.3C15.3 5.7 15.3 4.7 14.7 4.1C14.1 3.5 13.1 3.5 12.5 4.1L4 12.6L4 17L8.4 17L16.9 8.5C17.5 7.9 17.5 6.9 16.9 6.3L14.7 6.3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M3 21L7 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Process Jobs</span>
                        </a>
                        
                        <a href="{% url 'completed_jobs_allocator' %}" class="menu-item {% if 'completed_jobs_allocator' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <polyline points="20 6 9 17 4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Completed Jobs</span>
                        </a>
                        
                        <a href="{% url 'all_writers' %}" class="menu-item {% if 'all_writers' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">All Writers</span>
                        </a>
                        
                        <a href="{% url 'all_process_team' %}" class="menu-item {% if 'all_process_team' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                                    <polyline points="16 11 18 13 22 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">All Process Team</span>
                        </a>
                    </div>
                    {% endif %}

                    <!-- Writer Menu -->
                    {% if user.role == 'writer' %}
                    <div class="menu-section">
                        <div class="menu-section-title">Writer</div>
                        <a href="{% url 'writer_dashboard' %}" class="menu-item {% if 'writer_dashboard' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="3" y="3" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="14" y="3" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="14" y="14" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="3" y="14" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Dashboard</span>
                        </a>
                        
                        <a href="{% url 'all_projects' %}" class="menu-item {% if 'all_projects' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M22 19C22 19.5304 21.7893 20.0391 21.4142 20.4142C21.0391 20.7893 20.5304 21 20 21H4C3.46957 21 2.96086 20.7893 2.58579 20.4142C2.21071 20.0391 2 19.5304 2 19V5C2 4.46957 2.21071 3.96086 2.58579 3.58579C2.96086 3.21071 3.46957 3 4 3H9L11 6H20C20.5304 6 21.0391 6.21071 21.4142 6.58579C21.7893 6.96086 22 7.46957 22 8V19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">All Projects</span>
                        </a>
                        
                        <a href="{% url 'writer_issues' %}" class="menu-item {% if 'issues' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="12" y1="8" x2="12" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="12" y1="16" x2="12.01" y2="16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Issues</span>
                        </a>
                        
                        <a href="{% url 'writer_hold' %}" class="menu-item {% if 'hold' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="9" y="9" width="6" height="6" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Hold</span>
                        </a>
                        
                        <a href="{% url 'writer_close' %}" class="menu-item {% if 'close' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <polyline points="20 6 9 17 4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Close</span>
                        </a>
                    </div>
                    {% endif %}

                    <!-- Process Team Menu -->
                    {% if user.role == 'process' %}
                    <div class="menu-section">
                        <div class="menu-section-title">Process Team</div>
                        <a href="{% url 'process_dashboard' %}" class="menu-item {% if 'process_dashboard' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="3" y="3" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="14" y="3" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="14" y="14" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="3" y="14" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">Dashboard</span>
                        </a>
                        
                        <a href="{% url 'process_my_jobs' %}" class="menu-item {% if 'my-jobs' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 7H4C2.89543 7 2 7.89543 2 9V19C2 20.1046 2.89543 21 4 21H20C21.1046 21 22 20.1046 22 19V9C22 7.89543 21.1046 7 20 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M16 21V5C16 4.46957 15.7893 3.96086 15.4142 3.58579C15.0391 3.21071 14.5304 3 14 3H10C9.46957 3 8.96086 3.21071 8.58579 3.58579C8.21071 3.96086 8 4.46957 8 5V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">My Jobs</span>
                        </a>

                        <a href="{% url 'process_closed_jobs' %}" class="menu-item {% if 'closed-jobs' in request.path %}active{% endif %}">
                            <span class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <polyline points="20 6 9 17 4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                            <span class="menu-item-text">All Closed Jobs</span>
                        </a>
                    </div>
                    {% endif %}

                {% endif %}
            </nav>
        </aside>

        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Main Content -->
        <div class="main-container">
            <main class="content-wrapper">
                {% block content %}
                {% endblock %}
            </main>
        </div>

        <!-- Footer -->
        <footer class="app-footer">
            <div class="footer-content">
                <p>&copy; 2025 by CC Team. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Sidebar Toggle
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const appWrapper = document.querySelector('.app-wrapper');

        function toggleSidebar() {
            hamburgerBtn.classList.toggle('active');
            appWrapper.classList.toggle('sidebar-open');
        }

        hamburgerBtn.addEventListener('click', toggleSidebar);
        sidebarOverlay.addEventListener('click', toggleSidebar);

        // Close sidebar on menu item click (mobile)
        const menuItems = document.querySelectorAll('.menu-item');
        menuItems.forEach(item => {
            item.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    toggleSidebar();
                }
            });
        });

        // Modal Functions
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        // Close modal on overlay click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        });

        // Notification Function
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: var(--text-color); cursor: pointer; font-size: 20px; padding: 0; margin-left: 12px;">&times;</button>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideInRight 0.3s reverse';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // Form Validation Helper
        function validateForm(formId) {
            const form = document.getElementById(formId);
            if (!form) return false;

            const inputs = form.querySelectorAll('[required]');
            let isValid = true;

            inputs.forEach(input => {
                if (!input.value.trim()) {
                    input.style.borderColor = '#F44336';
                    isValid = false;
                } else {
                    input.style.borderColor = '';
                }
            });

            return isValid;
        }

        // Auto-hide messages after 5 seconds
        document.addEventListener('DOMContentLoaded', () => {
            const messages = document.querySelectorAll('.alert');
            messages.forEach(message => {
                setTimeout(() => {
                    message.style.animation = 'fadeOut 0.5s';
                    setTimeout(() => message.remove(), 500);
                }, 5000);
            });

            const initTables = () => {
                document.querySelectorAll('.table-container .data-table').forEach(table => {
                    const container = table.closest('.table-container');
                    if (!container) {
                        return;
                    }

                    // Ensure scroll body wrapper exists
                    if (!table.parentElement.classList.contains('table-scroll-body')) {
                        const wrapper = document.createElement('div');
                        wrapper.className = 'table-scroll-body';
                        container.insertBefore(wrapper, table);
                        wrapper.appendChild(table);
                    }

                    // Responsive data-labels
                    const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent.trim());
                    table.querySelectorAll('tbody tr').forEach(row => {
                        row.querySelectorAll('td').forEach((cell, index) => {
                            if (!cell.hasAttribute('data-label') && headers[index]) {
                                cell.setAttribute('data-label', headers[index]);
                            }
                        });
                    });

                    // Pagination
                    if (table.dataset.paginated === 'true') {
                        return;
                    }

                    const tbody = table.tBodies[0];
                    if (!tbody) {
                        return;
                    }

                    const mainRows = Array.from(tbody.rows).filter(
                        row => !row.classList.contains('kpi-row')
                    );
                    const pageSize = parseInt(table.dataset.pageSize || '10', 10);
                    if (mainRows.length <= pageSize) {
                        return;
                    }

                    table.dataset.paginated = 'true';

                    const paginationWrapper = document.createElement('div');
                    paginationWrapper.className = 'table-pagination';

                    const counter = document.createElement('span');
                    counter.className = 'table-pagination__counter';

                    const controls = document.createElement('div');
                    controls.className = 'table-pagination__controls';

                    const prevBtn = document.createElement('button');
                    prevBtn.type = 'button';
                    prevBtn.className = 'table-pagination__btn';
                    prevBtn.innerHTML = '&lsaquo;';

                    const nextBtn = document.createElement('button');
                    nextBtn.type = 'button';
                    nextBtn.className = 'table-pagination__btn';
                    nextBtn.innerHTML = '&rsaquo;';

                    controls.append(prevBtn, nextBtn);
                    paginationWrapper.append(counter, controls);
                    container.appendChild(paginationWrapper);

                    let currentPage = 0;
                    const totalRows = mainRows.length;
                    const totalPages = Math.ceil(totalRows / pageSize);

                    const getKpiRow = (row) => {
                        const next = row.nextElementSibling;
                        return next && next.classList.contains('kpi-row') ? next : null;
                    };

                    const renderPage = () => {
                        const start = currentPage * pageSize;
                        const end = Math.min(start + pageSize, totalRows);
                        mainRows.forEach((row, index) => {
                            const visible = index >= start && index < end;
                            row.style.display = visible ? '' : 'none';
                            const kpiRow = getKpiRow(row);
                            if (kpiRow) {
                                kpiRow.style.display = visible && kpiRow.classList.contains('active') ? '' : 'none';
                            }
                        });
                        const startDisplay = totalRows === 0 ? 0 : start + 1;
                        counter.textContent = `${startDisplay}-${end} of ${totalRows}`;
                        prevBtn.disabled = currentPage === 0;
                        nextBtn.disabled = currentPage >= totalPages - 1;
                    };

                    prevBtn.addEventListener('click', () => {
                        if (currentPage > 0) {
                            currentPage -= 1;
                            renderPage();
                        }
                    });

                    nextBtn.addEventListener('click', () => {
                        if (currentPage < totalPages - 1) {
                            currentPage += 1;
                            renderPage();
                        }
                    });

                    renderPage();
                });
            };

            initTables();
            window.refreshTableBehaviors = initTables;
        });


        

function toggleSubmenu(id, element) {
    const submenu = document.getElementById(id);
    const symbol = element.querySelector('.dropdown-toggle-symbol');

    if (submenu.style.display === "flex") {
        submenu.style.display = "none";
        symbol.textContent = "+";
    } else {
        submenu.style.display = "flex";
        symbol.textContent = "";
    }
}



    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>
