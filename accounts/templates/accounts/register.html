{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - CRM Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #666;
            z-index: 10;
        }
        .password-toggle:hover {
            color: #333;
        }
        .password-wrapper {
            position: relative;
        }
        .password-wrapper input {
            padding-right: 45px;
        }
        .required {
            color: red;
            margin-left: 3px;
        }
    </style>
</head>
<body>
    <div class="register-wrapper">
        <div class="register-container">
            <div class="register-header">
                <h1 class="register-logo">ðŸš€ CRM Portal</h1>
                <p class="register-subtitle">Create your account to get started</p>
            </div>

            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}

            <form method="post" class="register-form" id="registerForm">
                {% csrf_token %}
                
                <!-- Full Name -->
                <div class="form-group mb-3">
                    <label class="form-label">
                        Full Name<span class="required">*</span>
                    </label>
                    <input type="text" 
                           name="full_name" 
                           id="full_name"
                           class="form-control" 
                           placeholder="John Doe" 
                           required
                           maxlength="100">
                    <small class="form-text text-muted">Enter your first and last name</small>
                </div>

                <!-- Email -->
                <div class="form-group mb-3">
                    <label class="form-label">
                        Email Address<span class="required">*</span>
                    </label>
                    <input type="email" 
                           name="email" 
                           id="email" 
                           class="form-control" 
                           placeholder="you@example.com" 
                           required
                           autocomplete="email">
                    <small class="form-text text-muted">Use a valid and unique email address</small>
                </div>

                <!-- WhatsApp Number -->
                <div class="form-group mb-3">
                    <label class="form-label">
                        WhatsApp Number<span class="required">*</span>
                    </label>
                    <input type="tel" 
                           name="whatsapp_number" 
                           id="whatsapp_number"
                           class="form-control" 
                           placeholder="9876543210"
                           required
                           pattern="[0-9]{10}"
                           maxlength="10">
                    <small class="form-text text-muted">Enter 10 digit WhatsApp number</small>
                </div>

                <!-- Password Fields -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">
                            Password<span class="required">*</span>
                        </label>
                        <div class="password-wrapper">
                            <input type="password" 
                                   name="password1" 
                                   id="password1" 
                                   class="form-control" 
                                   placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" 
                                   required 
                                   minlength="8"
                                   autocomplete="new-password">
                            <span class="password-toggle" onclick="togglePassword('password1', this)">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </span>
                        </div>
                        <div class="password-strength" id="passwordStrength">
                            <div class="password-strength-bar"></div>
                        </div>
                        <small class="password-hint">Minimum 8 characters</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            Confirm Password<span class="required">*</span>
                        </label>
                        <div class="password-wrapper">
                            <input type="password" 
                                   name="password2" 
                                   id="password2" 
                                   class="form-control" 
                                   placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" 
                                   required 
                                   minlength="8"
                                   autocomplete="new-password">
                            <span class="password-toggle" onclick="togglePassword('password2', this)">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </span>
                        </div>
                        <small class="form-text text-danger" id="passwordMismatch" style="display: none;">
                            Passwords do not match
                        </small>
                    </div>
                </div>

                <!-- Terms and Conditions -->
                <div class="form-check mb-3">
                    <input type="checkbox" class="form-check-input" id="terms" name="terms" required>
                    <label class="form-check-label" for="terms">
                        I agree to the <a href="#" style="color: #667eea;">Terms and Conditions</a> and 
                        <a href="#" style="color: #667eea;">Privacy Policy</a>
                        <span class="required">*</span>
                    </label>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn btn-primary w-100" id="submitBtn">
                    <span id="btnText">Create Account</span>
                    <span id="btnSpinner" style="display: none;">
                        <span class="spinner-border spinner-border-sm" role="status"></span>
                        Creating...
                    </span>
                </button>
            </form>

            <div class="text-center mt-4">
                <p style="color: #666; margin: 0;">
                    Already have an account? 
                    <a href="{% url 'login' %}" style="color: #667eea; text-decoration: none; font-weight: 600;">
                        Sign In
                    </a>
                </p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Password visibility toggle
        function togglePassword(inputId, toggleElement) {
            const input = document.getElementById(inputId);
            const svg = toggleElement.querySelector('svg');
            
            if (input.type === 'password') {
                input.type = 'text';
                svg.innerHTML = `
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                    <line x1="1" y1="1" x2="23" y2="23"></line>
                `;
            } else {
                input.type = 'password';
                svg.innerHTML = `
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                `;
            }
        }

        // Password Strength Checker
        const password1 = document.getElementById('password1');
        const passwordStrength = document.getElementById('passwordStrength');
        
        password1.addEventListener('input', function() {
            const value = this.value;
            const strength = calculatePasswordStrength(value);
            
            if (value.length > 0) {
                passwordStrength.style.display = 'block';
                passwordStrength.className = 'password-strength ' + strength;
            } else {
                passwordStrength.style.display = 'none';
            }
        });

        function calculatePasswordStrength(password) {
            let strength = 0;
            
            if (password.length >= 8) strength++;
            if (password.length >= 12) strength++;
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
            if (/\d/.test(password)) strength++;
            if (/[^a-zA-Z0-9]/.test(password)) strength++;
            
            if (strength <= 2) return 'weak';
            if (strength <= 4) return 'medium';
            return 'strong';
        }

        // Password Match Validation
        const password2 = document.getElementById('password2');
        const passwordMismatch = document.getElementById('passwordMismatch');
        
        password2.addEventListener('input', function() {
            if (password1.value !== password2.value && password2.value.length > 0) {
                passwordMismatch.style.display = 'block';
                password2.style.borderColor = '#dc3545';
            } else {
                passwordMismatch.style.display = 'none';
                password2.style.borderColor = '';
            }
        });

        // Username Validation (alphanumeric only)
        const username = document.getElementById('username');
        username.addEventListener('input', function() {
            this.value = this.value.replace(/[^a-zA-Z0-9]/g, '');
        });

        // WhatsApp Number Validation (10 digits only)
        const whatsappNumber = document.getElementById('whatsapp_number');
        whatsappNumber.addEventListener('input', function() {
            this.value = this.value.replace(/[^0-9]/g, '').substring(0, 10);
        });

        // Email Validation
        const emailInput = document.getElementById('email');
        emailInput.addEventListener('blur', function() {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(this.value) && this.value.length > 0) {
                this.style.borderColor = '#dc3545';
            } else {
                this.style.borderColor = '';
            }
        });

        // Form Submission
        const registerForm = document.getElementById('registerForm');
        const submitBtn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const btnSpinner = document.getElementById('btnSpinner');

        registerForm.addEventListener('submit', function(e) {
            // Validate password match
            if (password1.value !== password2.value) {
                e.preventDefault();
                passwordMismatch.style.display = 'block';
                password2.style.borderColor = '#dc3545';
                password2.focus();
                return false;
            }

            // Show loading state
            submitBtn.disabled = true;
            btnText.style.display = 'none';
            btnSpinner.style.display = 'inline';
        });

        // Auto-dismiss alerts after 5 seconds
        setTimeout(function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);
    </script>
</body>
</html>