{% extends 'base.html' %}
{% load static %}

{% block title %}Pending Allocation - CRM Portal{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1 class="dashboard-title">Pending Allocation</h1>
    <p class="dashboard-subtitle">Jobs waiting to be allocated to team members</p>
</div>

<!-- Statistics Cards -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
    <div class="card" style="padding: 1.5rem; text-align: center;">
        <div style="font-size: 2.5rem; font-weight: 700; color: var(--primary);">{{ pending_stats.total }}</div>
        <div style="color: var(--text-color); opacity: 0.8; margin-top: 0.5rem;">Pending Jobs</div>
    </div>
    
    <div class="card" style="padding: 1.5rem; text-align: center;">
        <div style="font-size: 2.5rem; font-weight: 700; color: #2196F3;">{{ pending_stats.categories }}</div>
        <div style="color: var(--text-color); opacity: 0.8; margin-top: 0.5rem;">Categories</div>
    </div>
    
    <div class="card" style="padding: 1.5rem; text-align: center;">
        <div style="font-size: 2.5rem; font-weight: 700; color: #FF9800;">{{ pending_stats.high_priority }}</div>
        <div style="color: var(--text-color); opacity: 0.8; margin-top: 0.5rem;">High Priority</div>
    </div>
</div>

<!-- Jobs Table -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title">Pending Jobs List</h2>
    </div>
    <div class="card-body">
        {% if pending_jobs %}
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>SL No</th>
                        <th>Job ID</th>
                        <th>Topic</th>
                        <th>Word Count</th>
                        <th>Deadline</th>
                        <th>Priority</th>
                        <th>Job Category</th>
                        <th>Created By</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for job in pending_jobs %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td><strong style="color: var(--primary);">{{ job.masking_id }}</strong></td>
                        <td>{{ job.topic|truncatewords:10 }}</td>
                        <td><strong>{{ job.word_count }}</strong> / {{ job.max_word_limit }}</td>
                        <td>
                            <div style="font-weight: 600; color: #FF9800;">{{ job.deadline|date:"d/m/Y" }}</div>
                            <div style="font-size: 0.875rem; opacity: 0.7;">{{ job.deadline|date:"H:i" }}</div>
                        </td>
                        <td>
                            <span class="status-tag status-{{ job.priority }}">
                                {{ job.priority_label }}
                            </span>
                        </td>
                        <td>
                            <span class="status-tag" style="background-color: {% if job.job_category == 'IT' %}rgba(33, 150, 243, 0.2); color: #2196F3{% elif job.job_category == 'Finance' %}rgba(76, 175, 80, 0.2); color: #4CAF50{% else %}rgba(156, 39, 176, 0.2); color: #9C27B0{% endif %};">
                                {{ job.job_category }}
                            </span>
                        </td>
                        <td>{{ job.created_by }}</td>
                        <td>
                            <a href="{% url 'allocate_job' job.id %}" class="btn btn-primary" style="padding: 0.5rem 1rem; font-size: 0.875rem; text-decoration: none;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M16 21V5C16 4.46957 15.7893 3.96086 15.4142 3.58579C15.0391 3.21071 14.5304 3 14 3H10C9.46957 3 8.96086 3.21071 8.58579 3.58579C8.21071 3.96086 8 4.46957 8 5V21" stroke="currentColor" stroke-width="2"/>
                                    <polyline points="12 8 16 12 12 16" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                Allocate
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div style="text-align: center; padding: 3rem; color: var(--text-color); opacity: 0.6;">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-bottom: 1rem; opacity: 0.5;">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                <line x1="12" y1="8" x2="12" y2="12" stroke="currentColor" stroke-width="2"/>
                <line x1="12" y1="16" x2="12.01" y2="16" stroke="currentColor" stroke-width="2"/>
            </svg>
            <p style="font-size: 1.1rem; font-weight: 500;">No pending jobs</p>
            <p style="font-size: 0.9rem; margin-top: 0.5rem;">All jobs have been allocated</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
    .card {
        animation: fadeInUp 0.5s ease-out;
    }
    
    .data-table tbody tr:hover {
        background-color: var(--hover-bg);
        transform: scale(1.01);
    }
    
    .status-urgent {
        background-color: rgba(244, 67, 54, 0.2);
        color: #F44336;
        animation: pulse 2s infinite;
    }
    
    .status-high {
        background-color: rgba(255, 152, 0, 0.2);
        color: #FF9800;
    }
    
    .status-medium {
        background-color: rgba(33, 150, 243, 0.2);
        color: #2196F3;
    }
    
    .status-low {
        background-color: rgba(158, 158, 158, 0.2);
        color: #9E9E9E;
    }
</style>
{% endblock %}
